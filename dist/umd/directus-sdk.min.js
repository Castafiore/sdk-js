!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("base-64"),require("axios"),require("qs/lib/stringify")):"function"==typeof define&&define.amd?define(["exports","base-64","axios","qs/lib/stringify"],e):e((t=t||self).DirectusSDK={},t.base64,t.axios,t.qsStringify)}(this,function(t,o,e,r){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;function p(t,e){if(!0!=!!t)throw new Error("Invariant violation: "+e)}function n(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"}function i(t){return null!=t}function c(t){return t&&"string"==typeof t&&/\S/.test(t)}function s(t){return n("Number",t)&&isFinite(t)&&!isNaN(parseFloat(t))}function u(t){return t instanceof Function}function l(t){return n("Object",t)}function f(t){return n("Array",t)}function a(t){return!!f(t)&&0<t.length}function d(t){if(!l(t))return!1;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}var h=function(){return(h=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},m="directus-sdk-js",g=(Object.defineProperty(y.prototype,"token",{get:function(){return this.internalConfiguration.token},set:function(t){this.partialUpdate({token:t})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"tokenExpirationTime",{get:function(){return this.internalConfiguration.tokenExpirationTime},set:function(t){this.partialUpdate({tokenExpirationTime:6e4*t})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"url",{get:function(){return this.internalConfiguration.url},set:function(t){this.partialUpdate({url:t})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"project",{get:function(){return this.internalConfiguration.project},set:function(t){this.partialUpdate({project:t||"_"})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"localExp",{get:function(){return this.internalConfiguration.localExp},set:function(t){this.partialUpdate({localExp:t})},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"persist",{get:function(){return this.internalConfiguration.persist},set:function(t){this.internalConfiguration.persist=t},enumerable:!0,configurable:!0}),y.prototype.validate=function(){p(c(this.url),"configuration - url must be defined"),p(c(this.project),"configuration - project must be defined"),p(c(this.token),"configuration - project must be defined")},y.prototype.update=function(t){this.internalConfiguration=t,this.hydrate(t)},y.prototype.partialUpdate=function(t){this.internalConfiguration=h({},this.internalConfiguration,t),this.hydrate(this.internalConfiguration)},y.prototype.reset=function(){delete this.internalConfiguration.token,delete this.internalConfiguration.url,delete this.internalConfiguration.localExp,this.internalConfiguration.project="_",this.deleteHydratedConfig()},y.prototype.dehydrate=function(){if(this.storage&&this.persist){var t=this.storage.getItem(m);if(t){var e=JSON.parse(t);return this.internalConfiguration=e}}},y.prototype.hydrate=function(t){this.storage&&this.persist&&this.storage.setItem(m,JSON.stringify(t))},y.prototype.deleteHydratedConfig=function(){this.storage&&this.persist&&this.storage.removeItem(m)},y.prototype.dehydratedInitialConfiguration=function(t){if(!t)return{};var e=t.getItem(m);if(e)try{return JSON.parse(e)}catch(t){return{}}},y.defaults={project:"_",tokenExpirationTime:3e4},y);function y(t,e){void 0===t&&(t={});var r={};(this.storage=e)&&Boolean(t&&t.persist)&&(r=this.dehydratedInitialConfiguration(e));var n=Boolean(r.persist||t.persist),o=r.project||t.project||y.defaults.project,i=r.tokenExpirationTime||t.tokenExpirationTime||y.defaults.tokenExpirationTime;this.internalConfiguration=h({},t,r,{persist:n,project:o,tokenExpirationTime:i})}function b(t){return t.startsWith("directus_")?"/"+t.substr(9):"/items/"+t}function v(t){if(!t||t.length<0||t.split(".").length<=0)return{};try{var e=t.split(".")[1].replace("-","+").replace("_","/"),r=o.decode(e),n=JSON.parse(r);return s(n.exp)&&(n.exp=new Date(1e3*n.exp)),n}catch(t){return{}}}var j=(I.prototype.isLoggedIn=function(){return!!(c(this.config.token)&&c(this.config.url)&&c(this.config.project)&&d(this.getPayload())&&this.config.localExp>Date.now())},I.prototype.login=function(r,t){var n=this;return p(d(r),"malformed credentials"),p(c(r.email)&&c(r.password),"email & password are required in credentials"),this.config.token=null,c(r.url)&&(this.config.url=r.url),c(r.project)&&(this.config.project=r.project),(r.persist||t&&t.persist||this.config.persist)&&this.startInterval(),new Promise(function(e,t){n.inject.post("/auth/authenticate",{email:r.email,password:r.password}).then(function(t){return n.config.token=t.data.token}).then(function(t){n.config.localExp=new Date(Date.now()+n.config.tokenExpirationTime).getTime(),e({localExp:n.config.localExp,project:n.config.project,token:t,url:n.config.url})}).catch(t)})},I.prototype.logout=function(){this.config.reset(),this.refreshInterval&&this.stopInterval()},I.prototype.refreshIfNeeded=function(){var r=this,t=this.getPayload(),e=this.config,n=e.token,o=e.url,i=e.project,s=e.localExp;if(c(n)&&c(o)&&c(i)&&t&&t.exp){var a=(s||0)-Date.now();if(!(a<=0))return a<3e4?new Promise(function(e){r.refresh(n).then(function(t){r.config.localExp=new Date(Date.now()+r.config.tokenExpirationTime).getTime(),r.config.token=t.data.token||n,u(r.onAutoRefreshSuccess)&&r.onAutoRefreshSuccess(r.config),e([!0])}).catch(function(t){u(r.onAutoRefreshError)&&r.onAutoRefreshError(t),e([!0,t])})}):void 0;u(this.onAutoRefreshError)&&this.onAutoRefreshError({code:102,message:"auth_expired_token"})}},I.prototype.refresh=function(t){return p(c(t),"token must be a string"),this.inject.post("/auth/refresh",{token:t})},I.prototype.startInterval=function(t){t&&this.refreshIfNeeded(),this.refreshInterval=setInterval(this.refreshIfNeeded.bind(this),1e4)},I.prototype.stopInterval=function(){clearInterval(this.refreshInterval),this.refreshInterval=null},I.prototype.getPayload=function(){return c(this.config.token)?v(this.config.token):null},I);function I(t,e){this.config=t,this.inject=e,t.token&&t.token.includes(".")&&this.startInterval(!0)}function k(e,t){if(void 0===t&&(t=10),t<1)throw new Error("ConcurrencyManager Error: minimun concurrent requests is 1");var r={limit:t,queue:[],running:[],interceptors:{request:null,response:null},push:function(t){r.queue.push(t),r.shiftInitial()},shiftInitial:function(){setTimeout(function(){r.running.length<r.limit&&r.shift()},0)},shift:function(){if(r.queue.length){var t=r.queue.shift();t.resolver(t.request),r.running.push(t)}},requestHandler:function(e){return new Promise(function(t){r.push({request:e,resolver:t})})},responseHandler:function(t){return r.running.shift(),r.shift(),t},detach:function(){e.interceptors.request.eject(r.interceptors.request),e.interceptors.response.eject(r.interceptors.response)},attach:function(t){t&&(r.limit=t),r.interceptors.request=e.interceptors.request.use(r.requestHandler),r.interceptors.response=e.interceptors.response.use(r.responseHandler,r.responseHandler)}};return r}var P=(q.prototype.reset=function(){this.auth.logout(),this.config.deleteHydratedConfig()},q.prototype.get=function(t,e){return void 0===e&&(e={}),p(c(t),"endpoint must be a string"),p(l(e),"params must be an object or empty"),this.request("get",t,e)},q.prototype.post=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),p(c(t),"endpoint must be a string"),p(Array.isArray(e)?f(e):l(e),"body must be an array or object"),this.request("post",t,r,e)},q.prototype.patch=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),p(c(t),"endpoint must be a string"),p(Array.isArray(e)?f(e):l(e),"body must be an array or object"),this.request("patch",t,r,e)},q.prototype.put=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),p(c(t),"endpoint must be a string"),p(Array.isArray(e)?f(e):l(e),"body must be an array or object"),this.request("put",t,r,e)},q.prototype.delete=function(t){return p(c(t),"endpoint must be a string"),this.request("delete",t)},q.prototype.getPayload=function(){return c(this.config.token)?v(this.config.token):null},q.prototype.request=function(t,e,r,n,o,i,s){void 0===r&&(r={}),void 0===n&&(n={}),void 0===o&&(o=!1),void 0===i&&(i={}),void 0===s&&(s=!1),p(c(t),"method must be a string"),p(c(e),"endpoint must be a string"),p(l(r),"params must be an object or empty"),p(c(this.config.url),"main url must be defined (see constructor)"),p(Array.isArray(n)?f(n):l(n),"data must be an array or object");var a=this.config.url+"/";!1===o&&(a+=this.config.project+"/");var u={baseURL:a,data:n,headers:i,method:t,params:r,url:e};return this.config.token&&c(this.config.token)&&0<this.config.token.length&&(u.headers=i,u.headers.Authorization="Bearer "+this.config.token),this.xhr.request(u).then(function(t){return t.data}).then(function(e){if(!e||0===e.length)return e;if("object"!=typeof e)try{return s?e:JSON.parse(e)}catch(t){throw{data:e,error:t,json:!0}}return e}).catch(function(t){throw t.response?t.response.data.error:!0===t.json?{code:-2,data:t.data,error:t.error,message:"API returned invalid JSON"}:{code:-1,error:t,message:"Network Error"}})},q);function q(t){this.config=t,this.xhr=e.create({paramsSerializer:r,timeout:6e5}),this.concurrent=k(this.xhr,10),this.auth=new j(t,{post:this.post.bind(this)})}var w=function(i,s,a,u){return new(a=a||Promise)(function(t,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function n(t){try{o(u.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(r,n)}o((u=u.apply(i,s||[])).next())})},x=function(r,n){var o,i,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,i=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(r,a)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},C=(Object.defineProperty(E.prototype,"loggedIn",{get:function(){return this.api.auth.isLoggedIn()},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"payload",{get:function(){return this.config.token?this.api.getPayload():null},enumerable:!0,configurable:!0}),E.prototype.login=function(t,e){return this.api.auth.login(t,e)},E.prototype.logout=function(){this.api.auth.logout()},E.prototype.reset=function(){this.api.reset()},E.prototype.refreshIfNeeded=function(){return this.api.auth.refreshIfNeeded()},E.prototype.refresh=function(t){return this.api.auth.refresh(t)},E.prototype.requestPasswordReset=function(t){return p(c(t),"email must be a string"),this.api.post("/auth/password/request",{email:t})},E.prototype.getActivity=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/activity",t)},E.prototype.getMyBookmarks=function(t){return void 0===t&&(t={}),this.getCollectionPresets(t)},E.prototype.getCollections=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/collections",t)},E.prototype.getCollection=function(t,e){return void 0===e&&(e={}),p(c(t),"collection must be a string"),p(l(e),"params must be an object or empty"),this.api.get("/collections/"+t,e)},E.prototype.createCollection=function(t){return p(d(t),"data must be an object"),this.api.post("/collections",t)},E.prototype.updateCollection=function(t,e){return p(c(t),"collection must be a string"),p(d(e),"data must be an object"),this.api.patch("/collections/"+t,e)},E.prototype.deleteCollection=function(t){return p(c(t),"collection must be a string"),this.api.delete("/collections/"+t)},E.prototype.getCollectionPresets=function(t){void 0===t&&(t={}),p(c(this.config.token),"defined token is not a string"),p(l(t),"params must be an object or empty");var e=this.api.getPayload();return Promise.all([this.api.get("/collection_presets",{"filter[title][nnull]":1,"filter[user][eq]":e.id}),this.api.get("/collection_presets",{"filter[role][eq]":e.role,"filter[title][nnull]":1,"filter[user][null]":1})]).then(function(t){var e=t[0],r=t[1];return(e.data||[]).concat(r.data||[])})},E.prototype.createCollectionPreset=function(t){return p(d(t),"data must be an object"),this.api.post("/collection_presets",t)},E.prototype.updateCollectionPreset=function(t,e){return p(i(t),"primaryKey must be defined"),p(d(e),"data must be an object"),this.api.patch("/collection_presets/"+t,e)},E.prototype.deleteCollectionPreset=function(t){return p(i(t),"primaryKey must be defined"),this.api.delete("/collection_presets/"+t)},E.prototype.getInterfaces=function(){return this.api.request("get","/interfaces",{},{},!0)},E.prototype.getLayouts=function(){return this.api.request("get","/layouts",{},{},!0)},E.prototype.getPages=function(){return this.api.request("get","/pages",{},{},!0)},E.prototype.getAllFields=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/fields",t)},E.prototype.getFields=function(t,e){return void 0===e&&(e={}),p(c(t),"collection must be a string"),p(l(e),"params must be an object or empty"),this.api.get("/fields/"+t,e)},E.prototype.getField=function(t,e,r){return void 0===r&&(r={}),p(c(t),"collection must be a string"),p(c(e),"fieldName must be a string"),p(l(r),"params must be an object or empty"),this.api.get("/fields/"+t+"/"+e,r)},E.prototype.createField=function(t,e){return p(c(t),"collection must be a string"),p(d(e),"fieldInfo must be an object"),this.api.post("/fields/"+t,e)},E.prototype.updateField=function(t,e,r){return p(c(t),"collection must be a string"),p(c(e),"fieldName must be a string"),p(d(r),"fieldInfo must be an object"),this.api.patch("/fields/"+t+"/"+e,r)},E.prototype.updateFields=function(t,e,r){return void 0===r&&(r=null),p(c(t),"collection must be a string"),p(a(e),"fieldsInfoOrFieldNames must be an array"),r&&p(d(r),"fieldInfo must be an object"),r?this.api.patch("/fields/"+t+"/"+e.join(","),r):this.api.patch("/fields/"+t,e)},E.prototype.deleteField=function(t,e){return p(c(t),"collection must be a string"),p(c(e),"fieldName must be a string"),this.api.delete("/fields/"+t+"/"+e)},E.prototype.getFiles=function(e){return void 0===e&&(e={}),w(this,void 0,void 0,function(){return x(this,function(t){return p(l(e),"Params must be an object"),[2,this.api.get("/files",e)]})})},E.prototype.getFile=function(r,n){return void 0===n&&(n={}),w(this,void 0,void 0,function(){var e;return x(this,function(t){return p(c(r),"FileName must be string"),p(l(n),"Params must be an object"),e="string"==typeof r?r:r.join(","),[2,this.api.get("/files/"+e,n)]})})},E.prototype.uploadFiles=function(t,e){var r=this;void 0===e&&(e=function(){return{}});var n={Authorization:"Bearer "+this.config.token,"Content-Type":"multipart/form-data"};return this.api.concurrent.attach(5),this.api.xhr.post(this.config.url+"/"+this.config.project+"/files",t,{headers:n,onUploadProgress:e}).then(function(t){return r.api.concurrent.detach(),t.data}).catch(function(t){throw r.api.concurrent.detach(),t.response?t.response.data.error:{code:-1,error:t,message:"Network Error"}})},E.prototype.updateItem=function(t,e,r,n){void 0===n&&(n={}),p(c(t),"collection must be a string"),p(i(e),"primaryKey must be defined"),p(d(r),"body must be an object");var o=b(t);return this.api.patch(o+"/"+e,r,n)},E.prototype.updateItems=function(t,e,r){void 0===r&&(r={}),p(c(t),"collection must be a string"),p(a(e),"body must be an array");var n=b(t);return this.api.patch(n,e,r)},E.prototype.createItem=function(t,e){p(c(t),"collection must be a string"),p(d(e),"body must be an object");var r=b(t);return this.api.post(r,e)},E.prototype.createItems=function(t,e){p(c(t),"collection must be a string"),p(a(e),"body must be an array");var r=b(t);return this.api.post(r,e)},E.prototype.getItems=function(t,e){void 0===e&&(e={}),p(c(t),"collection must be a string"),p(l(e),"params must be an object or empty");var r=b(t);return this.api.get(r,e)},E.prototype.getItem=function(t,e,r){void 0===r&&(r={}),p(c(t),"collection must be a string"),p(i(e),"primaryKey must be defined"),p(l(r),"params must be an object or empty");var n=b(t);return this.api.get(n+"/"+e,r)},E.prototype.deleteItem=function(t,e){p(c(t),"collection must be a string"),p(i(e),"primaryKey must be defined");var r=b(t);return this.api.delete(r+"/"+e)},E.prototype.deleteItems=function(t,e){p(c(t),"collection must be a string"),p(a(e),"primaryKeys must be an array");var r=b(t);return this.api.delete(r+"/"+e.join())},E.prototype.getMyListingPreferences=function(t,e){void 0===e&&(e={}),p(c(this.config.token),"token must be defined"),p(l(e),"params must be an object or empty");var r=this.api.getPayload();return Promise.all([this.api.get("/collection_presets",{"filter[collection][eq]":t,"filter[role][null]":1,"filter[title][null]":1,"filter[user][null]":1,limit:1,sort:"-id"}),this.api.get("/collection_presets",{"filter[collection][eq]":t,"filter[role][eq]":r.role,"filter[title][null]":1,"filter[user][null]":1,limit:1,sort:"-id"}),this.api.get("/collection_presets",{"filter[collection][eq]":t,"filter[role][eq]":r.role,"filter[title][null]":1,"filter[user][eq]":r.id,limit:1,sort:"-id"})]).then(function(t){var e=t[0],r=t[1],n=t[2];return n.data&&0<n.data.length?n.data[0]:r.data&&0<r.data.length?r.data[0]:e.data&&0<e.data.length?e.data[0]:{}})},E.prototype.getPermissions=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.getItems("directus_permissions",t)},E.prototype.getMyPermissions=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/permissions/me",t)},E.prototype.createPermissions=function(t){return p(a(t),"data must be anarry"),this.api.post("/permissions",t)},E.prototype.updatePermissions=function(t){return p(a(t),"data must be anarry"),this.api.patch("/permissions",t)},E.prototype.getRelations=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/relations",t)},E.prototype.createRelation=function(t){return this.api.post("/relations",t)},E.prototype.updateRelation=function(t,e){return this.api.patch("/relations/"+t,e)},E.prototype.getCollectionRelations=function(t,e){return void 0===e&&(e={}),p(c(t),"collection must be a string"),p(l(e),"params must be an object or empty"),Promise.all([this.api.get("/relations",{"filter[collection_a][eq]":t}),this.api.get("/relations",{"filter[collection_b][eq]":t})])},E.prototype.getItemRevisions=function(t,e,r){void 0===r&&(r={}),p(c(t),"collection must be a string"),p(i(e),"primaryKey must be defined"),p(l(r),"params must be an object or empty");var n=b(t);return this.api.get(n+"/"+e+"/revisions",r)},E.prototype.revert=function(t,e,r){p(c(t),"collection must be a string"),p(i(e),"primaryKey must be defined"),p(s(r),"revisionID must be a number");var n=b(t);return this.api.patch(n+"/"+e+"/revert/"+r)},E.prototype.getRole=function(t,e){return void 0===e&&(e={}),p(s(t),"primaryKey must be a number"),p(l(e),"params must be an object or empty"),this.api.get("/roles/"+t,e)},E.prototype.getRoles=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/roles",t)},E.prototype.updateRole=function(t,e){return p(i(t),"primaryKey must be defined"),p(d(e),"body must be an object"),this.updateItem("directus_roles",t,e)},E.prototype.createRole=function(t){return p(d(t),"body must be an object"),this.createItem("directus_roles",t)},E.prototype.deleteRole=function(t){return p(i(t),"primaryKey must be defined"),this.deleteItem("directus_roles",t)},E.prototype.getSettings=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/settings",t)},E.prototype.getSettingsFields=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/settings/fields",t)},E.prototype.getUsers=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/users",t)},E.prototype.getUser=function(t,e){return void 0===e&&(e={}),p(i(t),"primaryKey must be defined"),p(l(e),"params must be an object or empty"),this.api.get("/users/"+t,e)},E.prototype.getMe=function(t){return void 0===t&&(t={}),p(l(t),"params must be an object or empty"),this.api.get("/users/me",t)},E.prototype.updateUser=function(t,e){return p(i(t),"primaryKey must be defined"),p(d(e),"body must be an object"),this.updateItem("directus_users",t,e)},E.prototype.updateDatabase=function(){return this.api.post("/update")},E.prototype.ping=function(){return this.api.request("get","/server/ping",{},{},!0,{},!0)},E.prototype.serverInfo=function(){return this.api.request("get","/",{},{},!0)},E.prototype.projectInfo=function(){return this.api.request("get","/")},E.prototype.getThirdPartyAuthProviders=function(){return this.api.get("/auth/sso")},E.getPayload=v,E);function E(t){this.config=new g(t),this.api=new P(this.config)}t.Configuration=g,t.SDK=C,t.concurrencyManager=k,t.default=C,t.getCollectionItemPath=b,t.getPayload=v,Object.defineProperty(t,"__esModule",{value:!0})});